{% extends "base.html" %}

{% block content %}
<div class="list-container">
    <h1 class="list-title">Lista de Producción</h1>
    
    <form action="{{ url_for('update_display_settings') }}" method="POST" class="settings-form">
        
        {% for cat_name, items in categorias.items() %}
        <div class="category-section">
            <h2 class="category-title">
                {{ cat_name|capitalize }} 
                <button type="button" class="toggle-all" data-category="{{ cat_name }}">Seleccionar Todos</button>
            </h2>
            <div class="list-items" data-category="{{ cat_name }}">
                {% for item in items %}
                {% set pid = item.product_id[0] %}
                <div class="list-item">
                    <label class="item-checkbox">
                        <input type="checkbox" name="display_products" value="{{ pid }}"
                               {% if pid in display_settings %}checked{% endif %}>
                        <span class="checkbox-custom"></span>
                    </label>
                    <span class="item-name">{{ item.product_id[1] }}</span>
                    <span class="item-quantity">{{ item.product_qty|format_number }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        
        <div class="settings-actions">
            <button type="submit" class="save-settings">Guardar Selección</button>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleButtons = document.querySelectorAll('.toggle-all');
    
    toggleButtons.forEach(button => {
        button.addEventListener('click', function() {
            const category = this.dataset.category;
            const section = document.querySelector(`.list-items[data-category="${category}"]`);
            const checkboxes = section.querySelectorAll('input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(checkbox => checkbox.checked = !allChecked);
        });
    });
});
</script>
{% endblock %}
