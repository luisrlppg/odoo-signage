{% extends "base.html" %}

{% block content %}
<div class="list-container">
    <h1 class="list-title">Lista de Producción</h1>
    
    <form action="{{ url_for('update_display_settings') }}" method="POST" class="settings-form">
        <div class="category-section">
            <h2 class="category-title">Inyección <button type="button" class="toggle-all" data-category="inyeccion">Seleccionar Todos</button></h2>
            <div class="list-items">
                {% for item in categorias.inyeccion %}
                <div class="list-item">
                    <label class="item-checkbox">
                        <input type="checkbox" name="display_products" value="{{ item.product_id[0] }}"
                               {% if item.product_id[0] in display_settings %}checked{% endif %}>
                        <span class="checkbox-custom"></span>
                    </label>
                    <span class="item-name">{{ item.product_id[1] }}</span>
                    <span class="item-quantity">{{ item.product_qty|format_number }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="category-section">
            <h2 class="category-title">Ensamble <button type="button" class="toggle-all" data-category="ensamble">Seleccionar Todos</button></h2>
            <div class="list-items">
                {% for item in categorias.ensamble %}
                <div class="list-item">
                    <label class="item-checkbox">
                        <input type="checkbox" name="display_products" value="{{ item.product_id[0] }}"
                               {% if item.product_id[0] in display_settings %}checked{% endif %}>
                        <span class="checkbox-custom"></span>
                    </label>
                    <span class="item-name">{{ item.product_id[1] }}</span>
                    <span class="item-quantity">{{ item.product_qty|format_number }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="category-section">
            <h2 class="category-title">Cepillo <button type="button" class="toggle-all" data-category="cepillo">Seleccionar Todos</button></h2>
            <div class="list-items">
                {% for item in categorias.cepillo %}
                <div class="list-item">
                    <label class="item-checkbox">
                        <input type="checkbox" name="display_products" value="{{ item.product_id[0] }}"
                               {% if item.product_id[0] in display_settings %}checked{% endif %}>
                        <span class="checkbox-custom"></span>
                    </label>
                    <span class="item-name">{{ item.product_id[1] }}</span>
                    <span class="item-quantity">{{ item.product_qty|format_number }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="settings-actions">
            <button type="submit" class="save-settings">Guardar Selección</button>
            <a href="{{ url_for('production_grid') }}" class="view-grid">Ver Grid</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleButtons = document.querySelectorAll('.toggle-all');
    
    toggleButtons.forEach(button => {
        button.addEventListener('click', function() {
            const category = this.dataset.category;
            const section = this.closest('.category-section');
            const checkboxes = section.querySelectorAll('input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = !allChecked;
            });
        });
    });
});
</script>
{% endblock %}