<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador de Etiquetas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
    .searchable-dropdown {
      position: relative;
      width: 100%;
    }
    
    .dropdown-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ccc;
      border-top: none;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }
    
    .dropdown-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }
    
    .dropdown-item:hover {
      background-color: #f5f5f5;
    }
    
    .dropdown-item.selected {
      background-color: #007bff;
      color: white;
    }
    </style>
</head>
<body>
  <div class="container">
  <h1>Generar etiqueta</h1>
  <form method="post" enctype="multipart/form-data">
    <div class="form-grid">
      <div class="form-section form-header">
        <input type="checkbox" id="edit_header" name="edit_header" value="1" onchange="toggleHeaderFields()">
        <label for="edit_header">Editar campos del encabezado</label>
        <label for="header_text">Título principal (opcional):</label>
        <input type="text" id="header_text" name="header_text" placeholder="Plásticos Plasa de Guadalajara">
        <label for="empresa_direccion">Dirección empresa (opcional):</label>
        <input type="text" id="empresa_direccion" name="empresa_direccion" placeholder="Calle Florentino Acosta #1090">
        <label for="empresa_ciudad">Ciudad y CP empresa (opcional):</label>
        <input type="text" id="empresa_ciudad" name="empresa_ciudad" placeholder="Guadalajara, Jalisco   C.P.44329">
        <label for="empresa_contacto">Contacto empresa (opcional):</label>
        <input type="text" id="empresa_contacto" name="empresa_contacto" placeholder="Teléfono: 33-3651-5424    www.plasticosplasa.com">
      </div>
      <div class="form-section form-cliente">
        <label>Cliente:</label>
        <div class="searchable-dropdown">
          <input type="text" id="cliente-search" placeholder="Buscar cliente..." autocomplete="off" required>
          <input type="hidden" name="cliente" id="cliente-value" required>
          <div id="cliente-dropdown" class="dropdown-list">
            {% for c in clientes %}
            <div class="dropdown-item" data-value="{{ c.id }}">{{ c.name }}</div>
            {% endfor %}
          </div>
        </div>
        <label for="cliente_name">Nombre cliente (opcional):</label>
        <input type="text" id="cliente_name" name="cliente_name" placeholder="Sobrescribe el nombre del cliente">
        <label for="cliente_phone">Teléfono cliente (opcional):</label>
        <input type="text" id="cliente_phone" name="cliente_phone" placeholder="Sobrescribe el teléfono">
        <label for="cliente_address">Dirección cliente (opcional):</label>
        <input type="text" id="cliente_address" name="cliente_address" placeholder="Sobrescribe la dirección">
        <label for="cliente_email">Email cliente (opcional):</label>
        <input type="text" id="cliente_email" name="cliente_email" placeholder="Sobrescribe el email">
      </div>
      <div class="form-section form-producto">
        <label>Producto:</label>
        <div class="searchable-dropdown">
          <input type="text" id="producto-search" placeholder="Buscar producto..." autocomplete="off" required>
          <input type="hidden" name="producto" id="producto-value" required>
          <div id="producto-dropdown" class="dropdown-list">
            {% for p in productos %}
            <div class="dropdown-item" data-value="{{ p.id }}">{{ p.display_name }}</div>
            {% endfor %}
          </div>
        </div>
        <label for="producto_name">Nombre producto (opcional):</label>
        <input type="text" id="producto_name" name="producto_name" placeholder="Sobrescribe el nombre del producto">
        <label for="producto_image">Imagen producto (opcional):</label>
        <input type="file" id="producto_image" name="producto_image" accept="image/*">
      </div>
      <div class="form-section form-datos">
        <label for="cantidad">Cantidad:</label>
        <input type="text" id="cantidad" name="cantidad" placeholder="Ingresa la cantidad">
        <label for="peso_bruto">Peso bruto:</label>
        <input type="text" id="peso_bruto" name="peso_bruto" placeholder="Kg">
        <label for="peso_neto">Peso neto:</label>
        <input type="text" id="peso_neto" name="peso_neto" placeholder="Kg">
        <label for="peso_unitario">Peso unitario:</label>
        <input type="text" id="peso_unitario" name="peso_unitario" placeholder="Kg">
      </div>
      <div class="form-section form-footer">
        <label for="footer_text">Texto pie de página:</label>
        <input type="text" id="footer_text" name="footer_text" placeholder="Generado por Plásticos Plasa - Etiqueta personalizada">
      </div>
    </div>
    <button type="submit">Generar PDF</button>
  </form>
    <script>
    function toggleHeaderFields() {
      var checked = document.getElementById('edit_header').checked;
      var fields = [
        'header_text',
        'empresa_direccion',
        'empresa_ciudad',
        'empresa_contacto'
      ];
      fields.forEach(function(id) {
        var el = document.getElementById(id);
        el.disabled = !checked;
        if (checked) {
          el.placeholder = '';
        } else {
          if (id === 'header_text') el.placeholder = 'Plásticos Plasa de Guadalajara';
          if (id === 'empresa_direccion') el.placeholder = 'Calle Florentino Acosta #1090';
          if (id === 'empresa_ciudad') el.placeholder = 'Guadalajara, Jalisco   C.P.44329';
          if (id === 'empresa_contacto') el.placeholder = 'Teléfono: 33-3651-5424    www.plasticosplasa.com';
        }
      });
    }

    // Searchable dropdown functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Function to setup searchable dropdown
      function setupSearchableDropdown(searchId, hiddenId, dropdownId) {
        const searchInput = document.getElementById(searchId);
        const hiddenInput = document.getElementById(hiddenId);
        const dropdown = document.getElementById(dropdownId);
        const items = dropdown.querySelectorAll('.dropdown-item');

        searchInput.addEventListener('input', function() {
          const filter = this.value.toLowerCase();
          let hasVisible = false;
          
          items.forEach(item => {
            const text = item.textContent.toLowerCase();
            if (text.includes(filter)) {
              item.style.display = 'block';
              hasVisible = true;
            } else {
              item.style.display = 'none';
            }
          });
          
          dropdown.style.display = hasVisible ? 'block' : 'none';
          hiddenInput.value = '';
        });

        searchInput.addEventListener('focus', function() {
          dropdown.style.display = 'block';
        });

        items.forEach(item => {
          item.addEventListener('click', function() {
            searchInput.value = this.textContent;
            hiddenInput.value = this.dataset.value;
            dropdown.style.display = 'none';
          });
        });
      }

      // Setup both dropdowns
      setupSearchableDropdown('cliente-search', 'cliente-value', 'cliente-dropdown');
      setupSearchableDropdown('producto-search', 'producto-value', 'producto-dropdown');

      // Close dropdowns when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.searchable-dropdown')) {
          document.querySelectorAll('.dropdown-list').forEach(dropdown => {
            dropdown.style.display = 'none';
          });
        }
      });

      toggleHeaderFields();
    });
    </script>
    </div>
</body>
</html>
